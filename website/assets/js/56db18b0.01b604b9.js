"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[8113],{2144:(e,s,i)=>{i.r(s),i.d(s,{assets:()=>l,contentTitle:()=>o,default:()=>h,frontMatter:()=>r,metadata:()=>n,toc:()=>c});const n=JSON.parse('{"id":"distroless-images","title":"Distroless Images","description":"Copa supports patching distroless container images that lack package managers. This page explains how distroless patching works and which image types are supported.","source":"@site/docs/distroless-images.md","sourceDirName":".","slug":"/distroless-images","permalink":"/copacetic/website/next/distroless-images","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"title":"Distroless Images"},"sidebar":"sidebar","previous":{"title":"App-Level Patching","permalink":"/copacetic/website/next/app-level-patching"},"next":{"title":"Docker Build Integration","permalink":"/copacetic/website/next/docker-build"}}');var a=i(4848),t=i(8453);const r={title:"Distroless Images"},o=void 0,l={},c=[{value:"Overview",id:"overview",level:2},{value:"Supported Distroless Images",id:"supported-distroless-images",level:2},{value:"DPKG-based (Debian)",id:"dpkg-based-debian",level:3},{value:"RPM-based (Azure Linux / CBL-Mariner)",id:"rpm-based-azure-linux--cbl-mariner",level:3},{value:"Unsupported Distroless Images",id:"unsupported-distroless-images",level:2},{value:"Alpine-based Distroless",id:"alpine-based-distroless",level:3},{value:"Chainguard Images",id:"chainguard-images",level:3},{value:"How It Works",id:"how-it-works",level:2},{value:"Usage Example",id:"usage-example",level:2},{value:"Limitations",id:"limitations",level:2},{value:"Troubleshooting",id:"troubleshooting",level:2},{value:"&quot;No upgradable packages found&quot;",id:"no-upgradable-packages-found",level:3},{value:"Tooling image pull failures",id:"tooling-image-pull-failures",level:3}];function d(e){const s={a:"a",code:"code",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(s.p,{children:"Copa supports patching distroless container images that lack package managers. This page explains how distroless patching works and which image types are supported."}),"\n",(0,a.jsx)(s.h2,{id:"overview",children:"Overview"}),"\n",(0,a.jsxs)(s.p,{children:[(0,a.jsx)(s.a,{href:"https://github.com/GoogleContainerTools/distroless",children:"Distroless images"})," are minimal container images that contain only the application and its runtime dependencies, without package managers, shells, or other OS utilities. While this reduces the attack surface, it traditionally makes patching vulnerabilities more difficult."]}),"\n",(0,a.jsxs)(s.p,{children:["Copa solves this by using a ",(0,a.jsx)(s.strong,{children:"tooling container"})," approach: it spins up a separate container with the necessary package management tools, downloads and processes the required updates, then copies the patched binaries to the target distroless image."]}),"\n",(0,a.jsx)(s.h2,{id:"supported-distroless-images",children:"Supported Distroless Images"}),"\n",(0,a.jsx)(s.h3,{id:"dpkg-based-debian",children:"DPKG-based (Debian)"}),"\n",(0,a.jsx)(s.p,{children:"Copa supports patching Debian-based distroless images, including:"}),"\n",(0,a.jsxs)(s.ul,{children:["\n",(0,a.jsxs)(s.li,{children:["Google's distroless images (",(0,a.jsx)(s.code,{children:"gcr.io/distroless/*"}),")"]}),"\n",(0,a.jsx)(s.li,{children:"Custom Debian-based distroless images"}),"\n"]}),"\n",(0,a.jsx)(s.p,{children:"For these images, Copa uses a Debian tooling image matching the target's version to process package updates."}),"\n",(0,a.jsx)(s.h3,{id:"rpm-based-azure-linux--cbl-mariner",children:"RPM-based (Azure Linux / CBL-Mariner)"}),"\n",(0,a.jsx)(s.p,{children:"Copa supports patching RPM-based distroless images, including:"}),"\n",(0,a.jsxs)(s.ul,{children:["\n",(0,a.jsxs)(s.li,{children:["Azure Linux distroless (",(0,a.jsx)(s.code,{children:"mcr.microsoft.com/azurelinux/distroless/base"}),")"]}),"\n",(0,a.jsxs)(s.li,{children:["CBL-Mariner distroless (",(0,a.jsx)(s.code,{children:"mcr.microsoft.com/cbl-mariner/distroless/base"}),")"]}),"\n"]}),"\n",(0,a.jsx)(s.p,{children:"For these images, Copa uses the corresponding Azure Linux or CBL-Mariner tooling image."}),"\n",(0,a.jsx)(s.h2,{id:"unsupported-distroless-images",children:"Unsupported Distroless Images"}),"\n",(0,a.jsx)(s.h3,{id:"alpine-based-distroless",children:"Alpine-based Distroless"}),"\n",(0,a.jsxs)(s.p,{children:["Copa does not support patching distroless Alpine images. Alpine images that include the ",(0,a.jsx)(s.code,{children:"apk"})," package manager can be patched normally."]}),"\n",(0,a.jsx)(s.h3,{id:"chainguard-images",children:"Chainguard Images"}),"\n",(0,a.jsx)(s.p,{children:"Copa does not support Chainguard's wolfi-based images."}),"\n",(0,a.jsx)(s.h2,{id:"how-it-works",children:"How It Works"}),"\n",(0,a.jsx)(s.p,{children:"When Copa detects a distroless image, it follows this process:"}),"\n",(0,a.jsxs)(s.ol,{children:["\n",(0,a.jsxs)(s.li,{children:["\n",(0,a.jsxs)(s.p,{children:[(0,a.jsx)(s.strong,{children:"Detection"}),": Copa probes the target image to identify its OS type and determine if it's a distroless variant by checking for package manager status files."]}),"\n"]}),"\n",(0,a.jsxs)(s.li,{children:["\n",(0,a.jsxs)(s.p,{children:[(0,a.jsx)(s.strong,{children:"Tooling Container"}),": Copa creates a tooling container based on the same OS distribution as the target image. For example:"]}),"\n",(0,a.jsxs)(s.ul,{children:["\n",(0,a.jsxs)(s.li,{children:["Debian distroless images use a ",(0,a.jsx)(s.code,{children:"debian:*-slim"})," tooling image"]}),"\n",(0,a.jsxs)(s.li,{children:["Azure Linux distroless images use ",(0,a.jsx)(s.code,{children:"ghcr.io/project-copacetic/copacetic/azurelinux/base/core"})," tooling image"]}),"\n"]}),"\n"]}),"\n",(0,a.jsxs)(s.li,{children:["\n",(0,a.jsxs)(s.p,{children:[(0,a.jsx)(s.strong,{children:"Package Processing"}),": The tooling container downloads the required security update packages and processes them."]}),"\n"]}),"\n",(0,a.jsxs)(s.li,{children:["\n",(0,a.jsxs)(s.p,{children:[(0,a.jsx)(s.strong,{children:"Binary Deployment"}),": Copa copies only the updated binaries from the tooling container to the target distroless image, creating a new patch layer."]}),"\n"]}),"\n",(0,a.jsxs)(s.li,{children:["\n",(0,a.jsxs)(s.p,{children:[(0,a.jsx)(s.strong,{children:"Layer Optimization"}),": The resulting image contains only the original layers plus a single patch layer with the security updates."]}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(s.h2,{id:"usage-example",children:"Usage Example"}),"\n",(0,a.jsx)(s.p,{children:"Patching a distroless image works the same as patching any other image:"}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-bash",children:"# Pull the distroless image\ndocker pull mcr.microsoft.com/cbl-mariner/distroless/base:2.0\n\n# Generate vulnerability report\ntrivy image --vuln-type os --ignore-unfixed -f json -o scan.json \\\n  mcr.microsoft.com/cbl-mariner/distroless/base:2.0\n\n# Patch the image\ncopa patch \\\n  -i mcr.microsoft.com/cbl-mariner/distroless/base:2.0 \\\n  -r scan.json \\\n  -t 2.0-patched\n"})}),"\n",(0,a.jsxs)(s.p,{children:["The patched image (",(0,a.jsx)(s.code,{children:"mcr.microsoft.com/cbl-mariner/distroless/base:2.0-patched"}),") will contain the security updates while maintaining the minimal distroless characteristics."]}),"\n",(0,a.jsx)(s.h2,{id:"limitations",children:"Limitations"}),"\n",(0,a.jsxs)(s.ul,{children:["\n",(0,a.jsxs)(s.li,{children:["\n",(0,a.jsxs)(s.p,{children:[(0,a.jsx)(s.strong,{children:"No shell access"}),": Since distroless images lack shells, Copa cannot execute commands directly in the target image. All package operations happen in the tooling container."]}),"\n"]}),"\n",(0,a.jsxs)(s.li,{children:["\n",(0,a.jsxs)(s.p,{children:[(0,a.jsx)(s.strong,{children:"Package availability"}),": Updates are limited to packages available in the distribution's official repositories."]}),"\n"]}),"\n",(0,a.jsxs)(s.li,{children:["\n",(0,a.jsxs)(s.p,{children:[(0,a.jsx)(s.strong,{children:"OS version matching"}),": The tooling container must match the target image's OS version. If Copa cannot determine the exact version, patching may fail."]}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(s.h2,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,a.jsx)(s.h3,{id:"no-upgradable-packages-found",children:'"No upgradable packages found"'}),"\n",(0,a.jsx)(s.p,{children:"This message indicates that either:"}),"\n",(0,a.jsxs)(s.ul,{children:["\n",(0,a.jsx)(s.li,{children:"There are no vulnerable packages with available updates"}),"\n",(0,a.jsx)(s.li,{children:"The vulnerability scanner report doesn't contain fixable vulnerabilities"}),"\n"]}),"\n",(0,a.jsx)(s.h3,{id:"tooling-image-pull-failures",children:"Tooling image pull failures"}),"\n",(0,a.jsxs)(s.p,{children:["If Copa fails to pull the tooling image, ensure you have network access to the container registry hosting the tooling images. See the ",(0,a.jsx)(s.a,{href:"/copacetic/website/next/faq#how-does-copa-determine-what-tooling-image-to-use",children:"FAQ"})," for details on which tooling images are used."]})]})}function h(e={}){const{wrapper:s}={...(0,t.R)(),...e.components};return s?(0,a.jsx)(s,{...e,children:(0,a.jsx)(d,{...e})}):d(e)}},8453:(e,s,i)=>{i.d(s,{R:()=>r,x:()=>o});var n=i(6540);const a={},t=n.createContext(a);function r(e){const s=n.useContext(t);return n.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function o(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:r(e.components),n.createElement(t.Provider,{value:s},e.children)}}}]);