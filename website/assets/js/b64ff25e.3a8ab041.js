"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[4619],{3781:(e,i,n)=>{n.r(i),n.d(i,{assets:()=>l,contentTitle:()=>s,default:()=>d,frontMatter:()=>a,metadata:()=>r,toc:()=>c});const r=JSON.parse('{"id":"troubleshooting","title":"Troubleshooting","description":"Copa and Trivy throw errors when Oracle Linux is passed in","source":"@site/versioned_docs/version-v0.8.x/troubleshooting.md","sourceDirName":".","slug":"/troubleshooting","permalink":"/copacetic/website/v0.8.x/troubleshooting","draft":false,"unlisted":false,"tags":[],"version":"v0.8.x","frontMatter":{"title":"Troubleshooting"},"sidebar":"sidebar","previous":{"title":"Tagging Guidelines","permalink":"/copacetic/website/v0.8.x/best-practices"},"next":{"title":"FAQ","permalink":"/copacetic/website/v0.8.x/faq"}}');var t=n(4848),o=n(8453);const a={title:"Troubleshooting"},s=void 0,l={},c=[{value:"Copa and Trivy throw errors when Oracle Linux is passed in",id:"copa-and-trivy-throw-errors-when-oracle-linux-is-passed-in",level:2},{value:"Filtering Vulnerabilities",id:"filtering-vulnerabilities",level:2},{value:"Rego Policy",id:"rego-policy",level:3},{value:"Ignore File",id:"ignore-file",level:3}];function h(e){const i={a:"a",code:"code",h2:"h2",h3:"h3",p:"p",pre:"pre",...(0,o.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(i.h2,{id:"copa-and-trivy-throw-errors-when-oracle-linux-is-passed-in",children:"Copa and Trivy throw errors when Oracle Linux is passed in"}),"\n",(0,t.jsx)(i.p,{children:"Copa supports patching Oracle Linux in two ways:"}),"\n",(0,t.jsxs)(i.p,{children:["With a vulnerability scan, ",(0,t.jsx)(i.code,{children:"--ignore-errors"})," must be passed in. This will patch all CVEs aside from false positives reported by Trivy:"]}),"\n",(0,t.jsx)(i.pre,{children:(0,t.jsx)(i.code,{className:"language-bash",children:"copa patch -r /oracle-7.9-vulns.json -i docker.io/library/oraclelinux:7.9 --ignore-errors\n"})}),"\n",(0,t.jsx)(i.p,{children:"Without a vulnerability scan, Copa will update all packages in the image:"}),"\n",(0,t.jsx)(i.pre,{children:(0,t.jsx)(i.code,{className:"language-bash",children:"copa patch -i docker.io/library/oraclelinux:7.9\n"})}),"\n",(0,t.jsxs)(i.p,{children:["Oracle reports CVEs in a way that causes Trivy to report false positives that Copa will be unable to patch. To patch the entire image, use the Copa ",(0,t.jsx)(i.code,{children:"--ignore-errors"})," flag or omit the vulnerability scan report to upgrade all outdated packages. See ",(0,t.jsx)(i.a,{href:"https://github.com/aquasecurity/trivy/issues/1967#issuecomment-1092987400",children:"this GitHub issue"})," for more information."]}),"\n",(0,t.jsx)(i.h2,{id:"filtering-vulnerabilities",children:"Filtering Vulnerabilities"}),"\n",(0,t.jsx)(i.p,{children:"You might want to filter/ignore some of the vulnerabilities while patching. To do so, you need to first filter those undesired vulnerabilities from your scanner output."}),"\n",(0,t.jsx)(i.p,{children:"For Trivy, vulnerabilities can be filtered by the following 2 ways:"}),"\n",(0,t.jsx)(i.h3,{id:"rego-policy",children:"Rego Policy"}),"\n",(0,t.jsx)(i.p,{children:"An example rego file which demonstrates how to ignore certain Vulnerability IDs or Package Names:"}),"\n",(0,t.jsx)(i.pre,{children:(0,t.jsx)(i.code,{className:"language-bash",children:'$ cat trivy_ignore.rego\n\npackage trivy\n\nimport data.lib.trivy\n\ndefault ignore = false\n\n\n# Ignore the following Vulnerability IDs\nignore_vulnerability_ids := {\n   "CVE-2018-14618"\n}\n# Ignore the following Package Names\nignore_pkgs := {"bash", "vim"}\n\n\n# For ignoring vulnID\nignore {\n   input.VulnerabilityID == ignore_vulnerability_ids[_]\n}\n# For ignoring pkgName\nignore {\n\tinput.PkgName == ignore_pkgs[_]\n}\n\n'})}),"\n",(0,t.jsxs)(i.p,{children:["After adding the above rego file, run the image scan with the ",(0,t.jsx)(i.code,{children:"--ignore-policy"})," flag followed by the file name to ignore them while scanning:"]}),"\n",(0,t.jsx)(i.pre,{children:(0,t.jsx)(i.code,{className:"language-bash",children:"trivy image --ignore-policy trivy_ignore.rego ruby:2.4.0\n"})}),"\n",(0,t.jsx)(i.p,{children:'In the above example, the vulnerability "CVE-2018-14618"  and the packages "bash" & "vim" are ignored while scanning, and hence patching the image.'}),"\n",(0,t.jsx)(i.h3,{id:"ignore-file",children:"Ignore File"}),"\n",(0,t.jsxs)(i.p,{children:["Use a ",(0,t.jsx)(i.code,{children:".trivyignore"})," file to list all the vulnerabilities you want to ignore."]}),"\n",(0,t.jsx)(i.p,{children:"Example:"}),"\n",(0,t.jsx)(i.pre,{children:(0,t.jsx)(i.code,{className:"language-bash",children:"$ cat .trivyignore\n\n# Accept the risk\nCVE-2018-14618\n"})}),"\n",(0,t.jsx)(i.p,{children:"In the above example, the vulnerability CVE-2018-14618 is ignored while scanning, and hence while patching the image."}),"\n",(0,t.jsxs)(i.p,{children:["For a more detailed explanation on how to ignore certain vulnerabilities with Trivy, please refer to the official documentation ",(0,t.jsx)(i.a,{href:"https://aquasecurity.github.io/trivy/v0.44/docs/configuration/filtering/",children:"here"}),"."]})]})}function d(e={}){const{wrapper:i}={...(0,o.R)(),...e.components};return i?(0,t.jsx)(i,{...e,children:(0,t.jsx)(h,{...e})}):h(e)}},8453:(e,i,n)=>{n.d(i,{R:()=>a,x:()=>s});var r=n(6540);const t={},o=r.createContext(t);function a(e){const i=r.useContext(o);return r.useMemo((function(){return"function"==typeof e?e(i):{...i,...e}}),[i,e])}function s(e){let i;return i=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:a(e.components),r.createElement(o.Provider,{value:i},e.children)}}}]);