"use strict";(globalThis.webpackChunkwebsite=globalThis.webpackChunkwebsite||[]).push([[5601],{9599(e,n,i){i.r(n),i.d(n,{assets:()=>d,contentTitle:()=>s,default:()=>h,frontMatter:()=>l,metadata:()=>t,toc:()=>c});const t=JSON.parse('{"id":"buildkit-frontend","title":"BuildKit Frontend","description":"Copa can be used as a BuildKit frontend to patch container images directly within BuildKit builds. This approach offers better integration with CI/CD pipelines and containerized workflows compared to the traditional CLI approach.","source":"@site/docs/buildkit-frontend.md","sourceDirName":".","slug":"/buildkit-frontend","permalink":"/copacetic/website/next/buildkit-frontend","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"title":"BuildKit Frontend"},"sidebar":"sidebar","previous":{"title":"Docker Desktop Extension","permalink":"/copacetic/website/next/docker-extension"},"next":{"title":"Custom BuildKit Addresses","permalink":"/copacetic/website/next/custom-address"}}');var r=i(4848),o=i(8453);const l={title:"BuildKit Frontend"},s=void 0,d={},c=[{value:"Overview",id:"overview",level:2},{value:"Prerequisites",id:"prerequisites",level:2},{value:"Basic Usage",id:"basic-usage",level:2},{value:"Docker Buildx (Recommended)",id:"docker-buildx-recommended",level:3},{value:"BuildKit CLI Alternative",id:"buildkit-cli-alternative",level:3},{value:"Configuration Options",id:"configuration-options",level:2},{value:"Required Options",id:"required-options",level:3},{value:"Report Options",id:"report-options",level:3},{value:"Platform Options",id:"platform-options",level:3},{value:"Output Options",id:"output-options",level:3},{value:"Behavior Options",id:"behavior-options",level:3},{value:"Experimental Options",id:"experimental-options",level:3},{value:"Context Handling",id:"context-handling",level:2},{value:"Single Report File",id:"single-report-file",level:3},{value:"Multi-platform Directory",id:"multi-platform-directory",level:3},{value:"Advanced Examples",id:"advanced-examples",level:2},{value:"Multi-platform Patching",id:"multi-platform-patching",level:3},{value:"CI/CD Integration",id:"cicd-integration",level:3},{value:"Custom BuildKit Address",id:"custom-buildkit-address",level:3},{value:"Library Vulnerability Patching (Experimental)",id:"library-vulnerability-patching-experimental",level:3},{value:"SBOM and Provenance Attestations",id:"sbom-and-provenance-attestations",level:3},{value:"Frontend vs CLI Comparison",id:"frontend-vs-cli-comparison",level:2},{value:"When to Use Each Approach",id:"when-to-use-each-approach",level:3},{value:"Troubleshooting",id:"troubleshooting",level:2},{value:"Common Issues",id:"common-issues",level:3},{value:"Next Steps",id:"next-steps",level:2}];function a(e){const n={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,o.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(n.p,{children:["Copa can be used as a ",(0,r.jsx)(n.a,{href:"https://docs.docker.com/build/buildkit/frontend/",children:"BuildKit frontend"})," to patch container images directly within BuildKit builds. This approach offers better integration with CI/CD pipelines and containerized workflows compared to the traditional CLI approach."]}),"\n",(0,r.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,r.jsxs)(n.p,{children:["The Copa BuildKit frontend leverages BuildKit's ",(0,r.jsx)(n.a,{href:"https://github.com/moby/buildkit?tab=readme-ov-file#exploring-dockerfiles",children:"gateway interface"})," to provide container vulnerability patching as a native BuildKit operation. This enables:"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Containerized Patching"}),": No need to install Copa CLI on build machines"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Build Context Integration"}),": Direct access to vulnerability reports and build artifacts"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"CI/CD Optimized"}),": Seamless integration with Docker Buildx, GitHub Actions, and other BuildKit-based tools"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Progress Tracking"}),": Native BuildKit progress reporting during patch operations"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Multi-platform Support"}),": Automatic handling of multi-architecture images"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,r.jsx)(n.p,{children:"Before using the Copa BuildKit frontend, ensure you have:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"BuildKit Instance"}),": Access to BuildKit via:","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"buildctl"})," CLI tool; or"]}),"\n",(0,r.jsxs)(n.li,{children:["Docker Buildx (",(0,r.jsx)(n.code,{children:"docker buildx build"}),"); or"]}),"\n",(0,r.jsx)(n.li,{children:"BuildKit daemon running locally"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Copa Frontend Image"}),": Available at ",(0,r.jsx)(n.code,{children:"ghcr.io/project-copacetic/copacetic-frontend"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Use ",(0,r.jsx)(n.code,{children:":latest"})," for the most recent stable release"]}),"\n",(0,r.jsxs)(n.li,{children:["Use ",(0,r.jsx)(n.code,{children:":vX.Y.Z"})," (e.g., ",(0,r.jsx)(n.code,{children:":v0.13.0"}),") to pin to a specific Copa version"]}),"\n",(0,r.jsx)(n.li,{children:"Frontend versions are aligned with Copa CLI releases"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Vulnerability Scanner"}),": Trivy or another supported scanner for generating reports"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Container Runtime"}),": Docker or Podman for image operations"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"basic-usage",children:"Basic Usage"}),"\n",(0,r.jsx)(n.h3,{id:"docker-buildx-recommended",children:"Docker Buildx (Recommended)"}),"\n",(0,r.jsx)(n.p,{children:"Docker Buildx provides the most seamless integration with existing Docker workflows:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Generate vulnerability report\ntrivy image --format json --output report.json nginx:1.21.6\n\n# Create build context directory with reports\nmkdir build-context\ncp report.json build-context/\n\n# Create empty Dockerfile (required for buildx)\ntouch build-context/Dockerfile\n\n# Set up buildx builder\ndocker buildx create --name copa-builder --use\n\n# Patch using buildx\ndocker buildx build \\\n  --build-arg BUILDKIT_SYNTAX=ghcr.io/project-copacetic/copacetic-frontend:latest \\\n  --build-arg image=nginx:1.21.6 \\\n  --build-arg report=report.json \\\n  --build-context report=./build-context \\\n  --output type=image,name=nginx:1.21.6-patched \\\n  ./build-context\n"})}),"\n",(0,r.jsx)(n.admonition,{title:"Docker Buildx Requirements",type:"info",children:(0,r.jsxs)(n.p,{children:["Docker Buildx requires a ",(0,r.jsx)(n.code,{children:"Dockerfile"})," in the build context, even if it's empty. The vulnerability reports can be placed in the same context directory."]})}),"\n",(0,r.jsx)(n.h3,{id:"buildkit-cli-alternative",children:"BuildKit CLI Alternative"}),"\n",(0,r.jsxs)(n.p,{children:["For environments without Docker Buildx, use the ",(0,r.jsx)(n.code,{children:"buildctl"})," CLI directly:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Generate vulnerability report (same as above)\ntrivy image --format json --output report.json nginx:1.21.6\n\n# Create report context directory\nmkdir reports\ncp report.json reports/\n\n# Patch using buildctl\nbuildctl build \\\n  --frontend=gateway.v0 \\\n  --opt source=ghcr.io/project-copacetic/copacetic-frontend:latest \\\n  --opt image=nginx:1.21.6 \\\n  --opt report=report.json \\\n  --opt scanner=trivy \\\n  --local report=./reports \\\n  --opt context:report=local:report \\\n  --output type=image,name=nginx:1.21.6-patched\n"})}),"\n",(0,r.jsx)(n.h2,{id:"configuration-options",children:"Configuration Options"}),"\n",(0,r.jsxs)(n.p,{children:["The Copa BuildKit frontend accepts the following options via ",(0,r.jsx)(n.code,{children:"--build-arg"})," (or ",(0,r.jsx)(n.code,{children:"--opt"})," in ",(0,r.jsx)(n.code,{children:"buildctl"}),") flags:"]}),"\n",(0,r.jsx)(n.h3,{id:"required-options",children:"Required Options"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Option"}),(0,r.jsx)(n.th,{children:"Description"}),(0,r.jsx)(n.th,{children:"Example"})]})}),(0,r.jsx)(n.tbody,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"image"})}),(0,r.jsx)(n.td,{children:"Base container image to patch"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"nginx:1.21.6"})})]})})]}),"\n",(0,r.jsx)(n.h3,{id:"report-options",children:"Report Options"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Option"}),(0,r.jsx)(n.th,{children:"Description"}),(0,r.jsx)(n.th,{children:"Default"}),(0,r.jsx)(n.th,{children:"Example"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"report"})}),(0,r.jsx)(n.td,{children:"Path to vulnerability report within context"}),(0,r.jsx)(n.td,{children:"-"}),(0,r.jsxs)(n.td,{children:[(0,r.jsx)(n.code,{children:"report.json"})," or ",(0,r.jsx)(n.code,{children:"."})," (for directories)"]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"scanner"})}),(0,r.jsx)(n.td,{children:"Vulnerability scanner type"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"trivy"})}),(0,r.jsxs)(n.td,{children:[(0,r.jsx)(n.code,{children:"trivy"}),", ",(0,r.jsx)(n.code,{children:"grype"})]})]})]})]}),"\n",(0,r.jsx)(n.h3,{id:"platform-options",children:"Platform Options"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Option"}),(0,r.jsx)(n.th,{children:"Description"}),(0,r.jsx)(n.th,{children:"Default"}),(0,r.jsx)(n.th,{children:"Example"})]})}),(0,r.jsx)(n.tbody,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"platform"})}),(0,r.jsx)(n.td,{children:"Target platform(s), comma-separated"}),(0,r.jsx)(n.td,{children:"Auto-detect"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"linux/amd64,linux/arm64"})})]})})]}),"\n",(0,r.jsx)(n.h3,{id:"output-options",children:"Output Options"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Option"}),(0,r.jsx)(n.th,{children:"Description"}),(0,r.jsx)(n.th,{children:"Default"}),(0,r.jsx)(n.th,{children:"Example"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"tag"})}),(0,r.jsx)(n.td,{children:"Custom tag for output image"}),(0,r.jsx)(n.td,{children:"-"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"v1.0.0-patched"})})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"suffix"})}),(0,r.jsx)(n.td,{children:"Suffix for output image name"}),(0,r.jsx)(n.td,{children:"-"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"-copa-patched"})})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"output"})}),(0,r.jsx)(n.td,{children:"VEX document output path"}),(0,r.jsx)(n.td,{children:"-"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"vex.json"})})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"format"})}),(0,r.jsx)(n.td,{children:"VEX document format"}),(0,r.jsx)(n.td,{children:"-"}),(0,r.jsxs)(n.td,{children:[(0,r.jsx)(n.code,{children:"openvex"}),", ",(0,r.jsx)(n.code,{children:"csaf"})]})]})]})]}),"\n",(0,r.jsx)(n.h3,{id:"behavior-options",children:"Behavior Options"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Option"}),(0,r.jsx)(n.th,{children:"Description"}),(0,r.jsx)(n.th,{children:"Default"}),(0,r.jsx)(n.th,{children:"Example"})]})}),(0,r.jsx)(n.tbody,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"ignore-errors"})}),(0,r.jsx)(n.td,{children:"Continue patching on non-critical errors"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"false"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"true"})})]})})]}),"\n",(0,r.jsx)(n.h3,{id:"experimental-options",children:"Experimental Options"}),"\n",(0,r.jsx)(n.admonition,{title:"Experimental Features",type:"warning",children:(0,r.jsx)(n.p,{children:"These options are experimental and subject to change. Use with caution in production environments."})}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Option"}),(0,r.jsx)(n.th,{children:"Description"}),(0,r.jsx)(n.th,{children:"Default"}),(0,r.jsx)(n.th,{children:"Example"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"pkg-types"})}),(0,r.jsxs)(n.td,{children:["Package types to patch, comma-separated list of ",(0,r.jsx)(n.code,{children:"os"})," and ",(0,r.jsx)(n.code,{children:"library"})]}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"os"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"os,library"})})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"library-patch-level"})}),(0,r.jsxs)(n.td,{children:["Library patch level preference: ",(0,r.jsx)(n.code,{children:"patch"}),", ",(0,r.jsx)(n.code,{children:"minor"}),", or ",(0,r.jsx)(n.code,{children:"major"})," (only when ",(0,r.jsx)(n.code,{children:"library"})," is set)"]}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"patch"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"minor"})})]})]})]}),"\n",(0,r.jsx)(n.h2,{id:"context-handling",children:"Context Handling"}),"\n",(0,r.jsx)(n.p,{children:"The Copa frontend uses BuildKit's context system to access vulnerability reports and other build artifacts."}),"\n",(0,r.jsx)(n.h3,{id:"single-report-file",children:"Single Report File"}),"\n",(0,r.jsx)(n.p,{children:"For single-platform patching with one vulnerability report:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Directory structure\nreports/\n\u2514\u2500\u2500 report.json\n\n# Command\nbuildctl build \\\n  --opt report=report.json \\\n  --local report=./reports \\\n  --opt context:report=local:report \\\n  # ... other options\n"})}),"\n",(0,r.jsx)(n.h3,{id:"multi-platform-directory",children:"Multi-platform Directory"}),"\n",(0,r.jsx)(n.p,{children:"For multi-platform patching with platform-specific reports:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Directory structure\nreports/\n\u251c\u2500\u2500 linux-amd64.json\n\u251c\u2500\u2500 linux-arm64.json\n\u2514\u2500\u2500 linux-arm-v7.json\n\n# Command\nbuildctl build \\\n  --opt report=. \\\n  --opt platform=linux/amd64,linux/arm64,linux/arm/v7 \\\n  --local report=./reports \\\n  --opt context:report=local:report \\\n  # ... other options\n"})}),"\n",(0,r.jsx)(n.admonition,{title:"Platform Naming",type:"note",children:(0,r.jsxs)(n.p,{children:["Platform-specific reports do not need to follow any specific naming pattern as long as they are correctly referenced in the ",(0,r.jsx)(n.code,{children:"report"})," option. However, using a consistent naming convention (e.g., ",(0,r.jsx)(n.code,{children:"linux-amd64.json"})," for ",(0,r.jsx)(n.code,{children:"linux/amd64"}),") can help avoid confusion."]})}),"\n",(0,r.jsx)(n.h2,{id:"advanced-examples",children:"Advanced Examples"}),"\n",(0,r.jsx)(n.h3,{id:"multi-platform-patching",children:"Multi-platform Patching"}),"\n",(0,r.jsx)(n.p,{children:"Patch a multi-architecture image with platform-specific vulnerability reports:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Generate reports for each platform\ntrivy image --platform linux/amd64 --format json --output linux-amd64.json nginx:1.21.6\ntrivy image --platform linux/arm64 --format json --output linux-arm64.json nginx:1.21.6\n\n# Organize reports\nmkdir reports\nmv linux-*.json reports/\n\n# Patch all platforms\nbuildctl build \\\n  --frontend=gateway.v0 \\\n  --opt source=ghcr.io/project-copacetic/copacetic-frontend:latest \\\n  --opt image=nginx:1.21.6 \\\n  --opt report=. \\\n  --opt scanner=trivy \\\n  --opt platform=linux/amd64,linux/arm64 \\\n  --local report=./reports \\\n  --opt context:report=local:report \\\n  --output type=image,name=nginx:1.21.6-multiarch-patched\n"})}),"\n",(0,r.jsx)(n.h3,{id:"cicd-integration",children:"CI/CD Integration"}),"\n",(0,r.jsx)(n.p,{children:"Example GitHub Actions workflow:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"name: Patch Container Images\non: [push]\n\njobs:\n  patch:\n    runs-on: ubuntu-latest\n    steps:\n      - uses: actions/checkout@v4\n\n      - name: Set up Docker Buildx\n        uses: docker/setup-buildx-action@v3\n\n      - name: Install Trivy\n        run: |\n          curl -sfL https://raw.githubusercontent.com/aquasecurity/trivy/main/contrib/install.sh | sh -s -- -b /usr/local/bin\n\n      - name: Generate vulnerability report\n        run: |\n          mkdir build-context\n          trivy image --format json --output build-context/report.json nginx:1.21.6\n          touch build-context/Dockerfile\n\n      - name: Patch image with Copa frontend\n        run: |\n          docker buildx build \\\n            --build-arg BUILDKIT_SYNTAX=ghcr.io/project-copacetic/copacetic-frontend:v0.13.0 \\\n            --build-arg image=nginx:1.21.6 \\\n            --build-arg report=report.json \\\n            --build-context report=./build-context \\\n            --output type=image,name=nginx:1.21.6-patched,push=true \\\n            ./build-context\n"})}),"\n",(0,r.jsx)(n.h3,{id:"custom-buildkit-address",children:"Custom BuildKit Address"}),"\n",(0,r.jsx)(n.p,{children:"Use with a specific BuildKit daemon:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Connect to remote BuildKit\nbuildctl --addr tcp://buildkit-server:1234 build \\\n  --frontend=gateway.v0 \\\n  --opt source=ghcr.io/project-copacetic/copacetic-frontend:latest \\\n  --opt image=nginx:1.21.6 \\\n  --opt report=report.json \\\n  --local report=./reports \\\n  --opt context:report=local:report \\\n  --output type=image,name=nginx:1.21.6-patched\n"})}),"\n",(0,r.jsx)(n.h3,{id:"library-vulnerability-patching-experimental",children:"Library Vulnerability Patching (Experimental)"}),"\n",(0,r.jsx)(n.admonition,{title:"Experimental Feature",type:"warning",children:(0,r.jsxs)(n.p,{children:["Library patching features (",(0,r.jsx)(n.code,{children:"pkg-types"})," and ",(0,r.jsx)(n.code,{children:"library-patch-level"}),") are experimental and may change in future releases. When using the Copa CLI, set ",(0,r.jsx)(n.code,{children:"COPA_EXPERIMENTAL=1"})," to enable these options. The BuildKit frontend supports these options without requiring the environment variable - simply include them as ",(0,r.jsx)(n.code,{children:"--build-arg"})," or ",(0,r.jsx)(n.code,{children:"--opt"})," parameters."]})}),"\n",(0,r.jsx)(n.p,{children:"Patch both OS and library vulnerabilities with preferred update level:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Generate comprehensive vulnerability report\ntrivy image --format json --output report.json myapp:latest\n\n# Create build context\nmkdir build-context\ncp report.json build-context/\ntouch build-context/Dockerfile\n\n# Patch both OS and library vulnerabilities, preferring minor version updates for libraries\ndocker buildx build \\\n  --build-arg BUILDKIT_SYNTAX=ghcr.io/project-copacetic/copacetic-frontend:latest \\\n  --build-arg image=myapp:latest \\\n  --build-arg report=report.json \\\n  --build-arg pkg-types=os,library \\\n  --build-arg library-patch-level=minor \\\n  --build-context report=./build-context \\\n  --output type=image,name=myapp:latest-patched \\\n  ./build-context\n"})}),"\n",(0,r.jsx)(n.admonition,{title:"Library Patching",type:"note",children:(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["The ",(0,r.jsx)(n.code,{children:"pkg-types"})," option accepts comma-separated values: ",(0,r.jsx)(n.code,{children:"os"}),", ",(0,r.jsx)(n.code,{children:"library"}),", or ",(0,r.jsx)(n.code,{children:"os,library"})]}),"\n",(0,r.jsxs)(n.li,{children:["The ",(0,r.jsx)(n.code,{children:"library-patch-level"})," option is only used when ",(0,r.jsx)(n.code,{children:"library"})," is included in ",(0,r.jsx)(n.code,{children:"pkg-types"})]}),"\n",(0,r.jsxs)(n.li,{children:["Patch levels: ",(0,r.jsx)(n.code,{children:"patch"})," (safest, minimal changes), ",(0,r.jsx)(n.code,{children:"minor"})," (moderate changes), ",(0,r.jsx)(n.code,{children:"major"})," (significant changes)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Large reports"}),": The frontend automatically reads vulnerability reports in chunks (8MB per chunk) to handle reports of any size, including those with many library vulnerabilities."]}),"\n"]})}),"\n",(0,r.jsx)(n.h3,{id:"sbom-and-provenance-attestations",children:"SBOM and Provenance Attestations"}),"\n",(0,r.jsx)(n.p,{children:"Since Copa runs as a standard BuildKit frontend, you can leverage BuildKit's native support for generating SBOM (Software Bill of Materials) and SLSA provenance attestations on patched images:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Patch with SBOM and provenance attestations\ndocker buildx build \\\n  --build-arg BUILDKIT_SYNTAX=ghcr.io/project-copacetic/copacetic-frontend:latest \\\n  --build-arg image=docker.io/library/nginx:1.21.6 \\\n  --build-arg report=report.json \\\n  --build-context report=./build-context \\\n  --sbom=true \\\n  --provenance=true \\\n  --output type=image,name=nginx:1.21.6-patched,push=true \\\n  ./build-context\n"})}),"\n",(0,r.jsx)(n.p,{children:"The patched image will include:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"SPDX SBOM"})," (",(0,r.jsx)(n.code,{children:"https://spdx.dev/Document"}),") - A Software Bill of Materials listing all packages in the patched image"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"SLSA Provenance"})," (",(0,r.jsx)(n.code,{children:"https://slsa.dev/provenance/v0.2"}),") - Build attestation documenting how the image was produced"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"You can inspect the attestations using:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# View attestation manifest\ndocker buildx imagetools inspect <image> --raw | jq '.manifests'\n\n# Or use cosign to verify\ncosign verify-attestation --type slsaprovenance <image>\n"})}),"\n",(0,r.jsx)(n.admonition,{type:"tip",children:(0,r.jsx)(n.p,{children:"SBOM and provenance attestations are generated by BuildKit, not by Copa itself. This means you get the same attestation capabilities as any other BuildKit-based build, with no additional configuration required from Copa."})}),"\n",(0,r.jsx)(n.h2,{id:"frontend-vs-cli-comparison",children:"Frontend vs CLI Comparison"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Aspect"}),(0,r.jsx)(n.th,{children:"BuildKit Frontend"}),(0,r.jsx)(n.th,{children:"Copa CLI"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"Installation"})}),(0,r.jsx)(n.td,{children:"No local installation required"}),(0,r.jsx)(n.td,{children:"Requires Copa binary installation"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"Context Handling"})}),(0,r.jsx)(n.td,{children:"Native BuildKit context support"}),(0,r.jsx)(n.td,{children:"Manual file management"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"CI/CD Integration"})}),(0,r.jsx)(n.td,{children:"Seamless with BuildKit-based workflows"}),(0,r.jsx)(n.td,{children:"Requires container or binary setup"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"Progress Tracking"})}),(0,r.jsx)(n.td,{children:"Native BuildKit progress reporting"}),(0,r.jsx)(n.td,{children:"CLI output only"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"Caching"})}),(0,r.jsx)(n.td,{children:"Leverages BuildKit's caching layers"}),(0,r.jsx)(n.td,{children:"Limited caching support"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"Multi-platform"})}),(0,r.jsx)(n.td,{children:"Automatic platform detection"}),(0,r.jsx)(n.td,{children:"Automatic when using report directory, manual otherwise"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"Resource Isolation"})}),(0,r.jsx)(n.td,{children:"Runs in isolated BuildKit containers"}),(0,r.jsx)(n.td,{children:"Uses local system resources"})]})]})]}),"\n",(0,r.jsx)(n.h3,{id:"when-to-use-each-approach",children:"When to Use Each Approach"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Use BuildKit Frontend when:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Integrating with CI/CD pipelines"}),"\n",(0,r.jsx)(n.li,{children:"Building containerized applications"}),"\n",(0,r.jsx)(n.li,{children:"Working with multi-platform images"}),"\n",(0,r.jsx)(n.li,{children:"Want native BuildKit progress and caching"}),"\n",(0,r.jsx)(n.li,{children:"Prefer not installing additional CLI tools"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Use Copa CLI when:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Interactive development and debugging"}),"\n",(0,r.jsx)(n.li,{children:"Simple one-off patching tasks"}),"\n",(0,r.jsx)(n.li,{children:"Need fine-grained control over the process"}),"\n",(0,r.jsx)(n.li,{children:"Working outside containerized environments"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,r.jsx)(n.h3,{id:"common-issues",children:"Common Issues"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Frontend image not found:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Error: failed to resolve frontend image\n# Solution: Verify frontend image reference\n# For Docker Buildx:\n--build-arg BUILDKIT_SYNTAX=ghcr.io/project-copacetic/copacetic-frontend:latest\n# For buildctl:\n--opt source=ghcr.io/project-copacetic/copacetic-frontend:latest\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Context not found:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Error: failed to read report from context\n# Solution: Ensure report context is properly mounted\n# For Docker Buildx:\n--build-arg report=report.json \\\n--build-context report=./build-context\n# For buildctl:\n--local report=./reports \\\n--opt context:report=local:report\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Platform mismatch:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Error: no report found for platform\n# Solution: Check platform-specific report file naming\n# Expected: linux-amd64.json for linux/amd64 platform\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"BuildKit connection issues:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Error: failed to dial buildkit daemon\n# Solution: Check BuildKit daemon status\ndocker ps | grep buildkitd\n# or\nbuildctl debug workers\n"})}),"\n",(0,r.jsx)(n.h2,{id:"next-steps",children:"Next Steps"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Learn about ",(0,r.jsx)(n.a,{href:"/copacetic/website/next/multiplatform-patching",children:"Multi-Platform Patching"})," strategies"]}),"\n",(0,r.jsxs)(n.li,{children:["Explore ",(0,r.jsx)(n.a,{href:"/copacetic/website/next/custom-address",children:"Custom BuildKit Addresses"})," for advanced setups"]}),"\n",(0,r.jsxs)(n.li,{children:["Check out the ",(0,r.jsx)(n.a,{href:"/copacetic/website/next/github-action",children:"Copa GitHub Action"})," for automated workflows"]}),"\n",(0,r.jsxs)(n.li,{children:["Review ",(0,r.jsx)(n.a,{href:"/copacetic/website/next/output",children:"Output Formats"})," for VEX document generation"]}),"\n"]}),"\n",(0,r.jsx)(n.admonition,{type:"tip",children:(0,r.jsx)(n.p,{children:"The BuildKit frontend automatically inherits your BuildKit configuration, including registry authentication, network settings, and caching policies. No additional setup is required for most environments."})})]})}function h(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(a,{...e})}):a(e)}},8453(e,n,i){i.d(n,{R:()=>l,x:()=>s});var t=i(6540);const r={},o=t.createContext(r);function l(e){const n=t.useContext(o);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:l(e.components),t.createElement(o.Provider,{value:n},e.children)}}}]);